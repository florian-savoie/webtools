{% set title = 'client acceuil' %}
{% extends "./layout/layout_nav.html.twig" %}
{% block css %}

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <!-- Flipster CSS -->
    <link rel="stylesheet" href="dist/jquery.flipster.min.css">
    <link rel="stylesheet" href="../assets/vendor/css/pages/app-chat.css" />

    <link rel="stylesheet" href="../assets/css/chat.css">

    <link rel="stylesheet" href="../../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="../../assets/vendor/libs/node-waves/node-waves.css" />
    <link rel="stylesheet" href="../../assets/vendor/libs/typeahead-js/typeahead.css" />
    <link rel="stylesheet" href="../../assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css" />
    <link rel="stylesheet" href="../../assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css" />
    <!-- Flipster Js -->
    <script src="dist/jquery.flipster.min.js"></script>


{% endblock %}
{% block contenu %}
<!-- Content -->
<!-- Users List Table -->
<div class="container mt-5">


    <!-- Basic Layout -->
    <div class="row">
        <div class="col-xl">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Ajouter un article </h5>
                </div>
                <div class="card-body">
                    <form method="POST" >
                        <div class="col-md-6 mb-4">
                            <div class="form-floating form-floating-outline">
                                <select id="category" name="category" class="select2 form-select" data-allow-clear="true">
                                    {% for category in categorys %}
                                        <option style="color:{{ category.color }}"  value="{{ category.id }}">{{ category.name }}</option>
                                    {% endfor %}
                                    <option style="color:{{ category.color }}" value="1000">autres "hor liste "</option>

                                </select>
                                <label for="multicol-country">Choisir une catégorie</label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-4"id="selectsouscat" hidden>
                            <div class="form-floating form-floating-outline">
                                <select id="souscategory" name="souscat" class="select2 form-select" data-allow-clear="true">
                                </select>
                                <label for="souscategory">Choisir une sous-catégorie</label>
                            </div>
                        </div>

                        <div class="form-floating form-floating-outline mb-4">
                            <input type="text" class="form-control" name="title" id="basic-default-fullname" placeholder="John Doe" />
                            <label for="basic-default-fullname">titre de l'aricle </label>
                        </div>
                        <div class="form-floating form-floating-outline mb-4">
                            <input type="text" class="form-control" name="url" id="basic-default-company" placeholder="inserer l'url de l'image" />
                            <label for="basic-default-company">url de l'image de presentation</label>
                        </div>
                        <div class="form-floating form-floating-outline mb-4">
                          <textarea
                                  id="basic-default-message"
                                  class="form-control"
                                  name="description"
                                  placeholder="Hi, Do you have a moment to talk Joe?"
                                  style="height: 60px"></textarea>
                            <label for="basic-default-message">description</label>
                        </div>
                        <button type="submit" name="publication" class="btn btn-primary">envoyer</button>
                    </form>
                </div>
            </div>
        </div>

    </div>
    {% if response is defined %}
        <div style="">
            {{ response }}test
        </div>
    {% endif %}

        </div>





        {% endblock %}

        {% block js %}

            <script src="../../assets/vendor/assets/js/form-basic-inputs.js"></script>

            <script>

let category = document.getElementById("category");
let souscategory = document.getElementById("souscategory");
let divsouscat = document.getElementById("selectsouscat");
category.onchange = function() {
    let idcategory = category.value;
    console.log(category.value);

    // Effectuer la requête Ajax
    $.ajax({
        url: '/show-souscategory',
        method: 'POST',
        data: {
            action: 'show-souscategory',
            idcategory: idcategory,
        },
        dataType: 'json', // Attendre une réponse JSON du serveur
        success: function (response) {
            if (response.hasOwnProperty('error')) {
                // Erreur lors de l'ajout du vote
                console.log('Erreur lors de l\'ajout du vote :', response.error);
            } else {
                souscategory.innerHTML = '';
                if (response.length > 0) {
                    for (let i = 0; i < response.length; i++) {
                        divsouscat.hidden = false;
                        let sousCat = response[i];
                        souscategory.innerHTML += `<option value="${sousCat.id}">${sousCat.name}</option>`;
                    }                        souscategory.innerHTML += `<option value="100000">autre ("hors liste " )</option>`;

                } else {
                    divsouscat.hidden = true; // Cacher l'élément
                }
            }
        },
        error: function (xhr, status, error) {
            // Gérer les erreurs lors de la requête Ajax
            console.error('Une erreur s\'est produite lors de la requête :', error);
        }
    });
};

$('.addsouscategory').click(function() {

    let name = $('#souscategory-input-' + $(this).data('idcategory')).val();
    let idcategory = $(this).data('idcategory');

    $.ajax({
        url: '/addsouscategory',
        type: 'post',
        dataType: 'json',
        data: {
            action: 'add-souscategory',
            name: name,
            idcategory: idcategory
        },
        success: function(response) {
            console.log(response);
            // Faire quelque chose avec la réponse du serveur, par exemple :
            // alert(response);
            // ou mettre à jour la liste des sous-catégories
            // $('.subcategories-list').append('<li>' + name + '</li>');
        },
        error: function(xhr, status, error) {
            console.log(error);
            // Gérer l'erreur
        }
    });

});

        </script>

        {% endblock %}