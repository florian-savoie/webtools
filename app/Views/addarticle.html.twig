{% set title = 'client acceuil' %}
{% extends "./layout/layout_nav.html.twig" %}
{% block css %}
<link rel="stylesheet" href="../../assets/vendor/css/pages/ui-carousel.css" />
<link rel="stylesheet" href="../../assets/vendor/libs/swiper/swiper.css" />
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Flipster CSS -->
<link rel="stylesheet" href="dist/jquery.flipster.min.css">

<link rel="stylesheet" href="../assets/css/time-line.css">
<!-- Flipster Js -->
<script src="dist/jquery.flipster.min.js"></script>
<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

<!-- Icons -->
<link rel="stylesheet" href="../../assets/vendor/fonts/materialdesignicons.css" />
<link rel="stylesheet" href="../../assets/vendor/fonts/fontawesome.css" />

<!-- Core CSS -->
<link rel="stylesheet" href="../../assets/vendor/css/rtl/core.css" class="template-customizer-core-css" />
<link rel="stylesheet" href="../../assets/vendor/css/rtl/theme-default.css" class="template-customizer-theme-css" />
<link rel="stylesheet" href="../../assets/css/demo.css" />

<!-- Vendors CSS -->
<link rel="stylesheet" href="../../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
<link rel="stylesheet" href="../../assets/vendor/libs/node-waves/node-waves.css" />
<link rel="stylesheet" href="../../assets/vendor/libs/typeahead-js/typeahead.css" />
<link rel="stylesheet" href="../../assets/vendor/libs/bs-stepper/bs-stepper.css" />
<link rel="stylesheet" href="../../assets/vendor/libs/select2/select2.css" />
<link rel="stylesheet" href="../../assets/vendor/libs/tagify/tagify.css" />
<link rel="stylesheet" href="../../assets/vendor/libs/flatpickr/flatpickr.css" />
<link rel="stylesheet" href="../../assets/vendor/libs/formvalidation/dist/css/formValidation.min.css" />

<!-- Page CSS -->

<!-- Helpers -->
<script src="../../assets/vendor/js/helpers.js"></script>

<!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
<!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
<script src="../../assets/vendor/js/template-customizer.js"></script>
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script src="../../assets/js/config.js"></script>

{% endblock %}
{% block contenu %}
<!-- Content -->
<!-- Users List Table -->
<div class="container mt-5">


    <!-- Basic Layout -->
    <div class="row">
        <div class="col-xl">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Ajouter un article </h5>
                </div>
                <div class="card-body">
                    <form method="POST" >
                        <div class="col-md-6 mb-4">
                            <div class="form-floating form-floating-outline">
                                <select id="category" name="category" class="select2 form-select" data-allow-clear="true">
                                    {% for category in categorys %}
                                        <option style="color:{{ category.color }}"  value="{{ category.id }}">{{ category.name }}</option>
                                    {% endfor %}
                                    <option style="color:{{ category.color }}" value="1000">autres "hor liste "</option>

                                </select>
                                <label for="multicol-country">Choisir une catégorie</label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-4"id="selectsouscat" hidden>
                            <div class="form-floating form-floating-outline">
                                <select id="souscategory" name="souscat" class="select2 form-select" data-allow-clear="true">
                                </select>
                                <label for="souscategory">Choisir une sous-catégorie</label>
                            </div>
                        </div>

                        <div class="form-floating form-floating-outline mb-4">
                            <input type="text" class="form-control" name="title" id="basic-default-fullname" placeholder="John Doe" />
                            <label for="basic-default-fullname">titre de l'aricle </label>
                        </div>
                        <div class="form-floating form-floating-outline mb-4">
                            <input type="text" class="form-control" name="url" id="basic-default-company" placeholder="inserer l'url de l'image" />
                            <label for="basic-default-company">url de l'image de presentation</label>
                        </div>
                        <div class="form-floating form-floating-outline mb-4">
                          <textarea
                                  id="basic-default-message"
                                  class="form-control"
                                  name="description"
                                  placeholder="Hi, Do you have a moment to talk Joe?"
                                  style="height: 60px"></textarea>
                            <label for="basic-default-message">description</label>
                        </div>
                        <button type="submit" name="publication" class="btn btn-primary">envoyer</button>
                    </form>
                </div>
            </div>
        </div>

    </div>
    {% if response is defined %}
        <div style="">
            {{ response }}test
        </div>
    {% endif %}

        </div>





        {% endblock %}

        {% block js %}

        <script src="../assets/js/time-line/client/caroussel.js"></script>
        <script src="../assets/js/time-line/artisan/delete-like-photo.js"></script>
        <script src="../assets/js/time-line/artisan/like-photo.js"></script>
        <script src="../assets/js/time-line/artisan/envent-form.js"></script>
        <script src="../assets/js/time-line/artisan/compression-photo.js"></script>
        <script src="../../assets/vendor/assets/js/form-basic-inputs.js"></script>
        <script src="../../assets/vendor/assets/js/extended-ui-timeline.js"></script>
        <script src="../../assets/vendor/libs/swiper/swiper.js"></script>
        <!-- build:js assets/vendor/js/core.js -->
        <script src="../../assets/vendor/libs/jquery/jquery.js"></script>
        <script src="../../assets/vendor/libs/popper/popper.js"></script>
        <script src="../../assets/vendor/js/bootstrap.js"></script>
        <script src="../../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
        <script src="../../assets/vendor/libs/node-waves/node-waves.js"></script>

        <script src="../../assets/vendor/libs/hammer/hammer.js"></script>
        <script src="../../assets/vendor/libs/i18n/i18n.js"></script>
        <script src="../../assets/vendor/libs/typeahead-js/typeahead.js"></script>

        <script src="../../assets/vendor/js/menu.js"></script>
        <!-- endbuild -->

        <!-- Vendors JS -->
        <script src="../../assets/vendor/libs/cleavejs/cleave.js"></script>
        <script src="../../assets/vendor/libs/cleavejs/cleave-phone.js"></script>
        <script src="../../assets/vendor/libs/bs-stepper/bs-stepper.js"></script>
        <script src="../../assets/vendor/libs/select2/select2.js"></script>
        <script src="../../assets/vendor/libs/tagify/tagify.js"></script>
        <script src="../../assets/vendor/libs/flatpickr/flatpickr.js"></script>
        <script src="../../assets/vendor/libs/formvalidation/dist/js/FormValidation.min.js"></script>
        <script src="../../assets/vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js"></script>
        <script src="../../assets/vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js"></script>

        <!-- Main JS -->
        <script src="../../assets/js/main.js"></script>

        <!-- Page JS -->

        <script src="../../assets/js/wizard-ex-property-listing.js"></script>
        <script>

let category = document.getElementById("category");
let souscategory = document.getElementById("souscategory");
let divsouscat = document.getElementById("selectsouscat");
category.onchange = function() {
    let idcategory = category.value;
    console.log(category.value);

    // Effectuer la requête Ajax
    $.ajax({
        url: '/show-souscategory',
        method: 'POST',
        data: {
            action: 'show-souscategory',
            idcategory: idcategory,
        },
        dataType: 'json', // Attendre une réponse JSON du serveur
        success: function (response) {
            if (response.hasOwnProperty('error')) {
                // Erreur lors de l'ajout du vote
                console.log('Erreur lors de l\'ajout du vote :', response.error);
            } else {
                souscategory.innerHTML = '';
                if (response.length > 0) {
                    for (let i = 0; i < response.length; i++) {
                        divsouscat.hidden = false;
                        let sousCat = response[i];
                        souscategory.innerHTML += `<option value="${sousCat.id}">${sousCat.name}</option>`;
                    }                        souscategory.innerHTML += `<option value="100000">autre ("hors liste " )</option>`;

                } else {
                    divsouscat.hidden = true; // Cacher l'élément
                }
            }
        },
        error: function (xhr, status, error) {
            // Gérer les erreurs lors de la requête Ajax
            console.error('Une erreur s\'est produite lors de la requête :', error);
        }
    });
};

$('.addsouscategory').click(function() {

    let name = $('#souscategory-input-' + $(this).data('idcategory')).val();
    let idcategory = $(this).data('idcategory');

    $.ajax({
        url: '/addsouscategory',
        type: 'post',
        dataType: 'json',
        data: {
            action: 'add-souscategory',
            name: name,
            idcategory: idcategory
        },
        success: function(response) {
            console.log(response);
            // Faire quelque chose avec la réponse du serveur, par exemple :
            // alert(response);
            // ou mettre à jour la liste des sous-catégories
            // $('.subcategories-list').append('<li>' + name + '</li>');
        },
        error: function(xhr, status, error) {
            console.log(error);
            // Gérer l'erreur
        }
    });

});

        </script>

        {% endblock %}